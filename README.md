# Emaze Pongo

Emaze Pongo is a small java library inspired to the Vaughn Vernon article [The Ideal Domain-Driven Design Aggregate Store?](https://vaughnvernon.co/?p=942).

Essentially it allows to manage and query easily a repository of entities stored as JSON objects on PostgreSQL, without the aid of a complex ORM.

Emaze Pongo is written in Kotlin, but it is thought to be Java-friendly.

## Requirements

* JDK 1.8
* PostgreSQL >= 9.5

## Features

* automatic save or update (using an autogenerated surrogate id)
* detection of optimistic locking conflicts
* (optional) auto-creation of tables and indexes

## Usage

Check the [API](https://github.com/emaze/emaze-pongo/blob/master/src/main/kotlin/api.kt).
```java
// A sample entity
public class User extends Identifiable {

    public final String name;

    public User(String name) {
        this.name = name;
    }
}

// The repository of Users
public interface UserRepository extends EntityRepository<User> {

   default Optional<User> findByName(String name) {
       return findFirstLike(singletonMap("name", name));
              // or 
              findFirst("where data @> ?", json(singletonMap("name", name)));
              // or
              findFirst("where data->>'name' = ?", name);
   }
}

// The real repository (i.e. created with Spring)
@Configuration
public class Config {
    @Bean
    public EntityRepositoryFactory entityRepositories(DataSource dataSource, ObjectMapper mapper) {
        return new PostgresJsonRepositoryFactory(dataSource, mapper);
    }
    
    @Bean
    public UserRepository users(PostgresJsonRepositoryFactory factory) {
        return (UserRepository) factory.create(User.class).createTable().createIndex();
    }
}
```

## Development

Build with Maven >= 3 and Docker:
```bash
mvn package
```

## Roadmap

* Provide a simpler way to query the aggregates using an SQL query translated to a JSON-based query
* Integrate it with the Spring transaction manager in order to support the automatic updates of the changed entities
* Introduce an optional entities cache at transaction level

## Contribute!

Emaze Pongo is under active development, your contribution is welcome!

## License

Attribution-ShareAlike 4.0 International